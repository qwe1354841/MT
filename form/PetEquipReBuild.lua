PetEquipReBuild = {}

PetEquipReBuild.LibraryLink = {
	{EquipType = 0, SiteType = 0, Role = 0, Level = 0, Alevel = 0, LockAttr = {"血量上限","物防"}, 
		RandAttr = {'Kangxing_Yifu',1,'Qiangfa_Yifu',2,'Shuxing_Yifu',1},
		Consume = {MoneyType = 5, MoneyVal = 15000, itemList = {"仙梦石"}},
		},
	{EquipType = 1, SiteType = 1, Role = 0, Level = 0, Alevel = 2, LockAttr = {"血量上限","物防"}, 
		RandAttr = {'Kangxing_Yifu',1,'Qiangfa_Yifu',2,'Shuxing_Yifu',1},
		Consume = {MoneyType = 5, MoneyVal = 15000, itemList = {"仙梦石"}},
		},
}

PetEquipReBuild.KeyNameLink = {
    ["15级项圈"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Ring',1},},
    ["45级项圈"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Ring',1},},
    ["65级项圈"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Ring',1},},
    ["85级项圈"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Ring',1},},
    ["105级项圈"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Ring',1},},
    ["125级项圈"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Ring',1},},
    ["15级项圈蓝"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Ring',1},},
    ["45级项圈蓝"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Ring',1},},
    ["65级项圈蓝"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Ring',1},},
    ["85级项圈蓝"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Ring',1},},
    ["105级项圈蓝"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Ring',1},},
    ["125级项圈蓝"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Ring',1},},
    ["15级项圈紫"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Ring',1},},
    ["45级项圈紫"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Ring',1},},
    ["65级项圈紫"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Ring',1},},
    ["85级项圈紫"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Ring',1},},
    ["105级项圈紫"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Ring',1},},
    ["125级项圈紫"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Ring',1},},
    ["15级项圈橙"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Ring',1},},
    ["45级项圈橙"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Ring',1},},
    ["65级项圈橙"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Ring',1},},
    ["85级项圈橙"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Ring',1},},
    ["105级项圈橙"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Ring',1},},
    ["125级项圈橙"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Ring',1},},
    ["15级盔甲物防"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Armor',1},},
    ["45级盔甲物防"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Armor',1},},
    ["65级盔甲物防"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Armor',1},},
    ["85级盔甲物防"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Armor',1},},
    ["105级盔甲物防"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Armor',1},},
    ["125级盔甲物防"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Armor',1},},
    ["15级盔甲物防蓝"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Armor',1},},
    ["45级盔甲物防蓝"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Armor',1},},
    ["65级盔甲物防蓝"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Armor',1},},
    ["85级盔甲物防蓝"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Armor',1},},
    ["105级盔甲物防蓝"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Armor',1},},
    ["125级盔甲物防蓝"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Armor',1},},
    ["15级盔甲物防紫"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Armor',1},},
    ["45级盔甲物防紫"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Armor',1},},
    ["65级盔甲物防紫"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Armor',1},},
    ["85级盔甲物防紫"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Armor',1},},
    ["105级盔甲物防紫"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Armor',1},},
    ["125级盔甲物防紫"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Armor',1},},
    ["15级盔甲物防橙"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Armor',1},},
    ["45级盔甲物防橙"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Armor',1},},
    ["65级盔甲物防橙"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Armor',1},},
    ["85级盔甲物防橙"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Armor',1},},
    ["105级盔甲物防橙"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Armor',1},},
    ["125级盔甲物防橙"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Armor',1},},
    ["15级盔甲法防"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Armor',1},},
    ["45级盔甲法防"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Armor',1},},
    ["65级盔甲法防"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Armor',1},},
    ["85级盔甲法防"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Armor',1},},
    ["105级盔甲法防"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Armor',1},},
    ["125级盔甲法防"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Armor',1},},
    ["15级盔甲法防蓝"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Armor',1},},
    ["45级盔甲法防蓝"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Armor',1},},
    ["65级盔甲法防蓝"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Armor',1},},
    ["85级盔甲法防蓝"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Armor',1},},
    ["105级盔甲法防蓝"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Armor',1},},
    ["125级盔甲法防蓝"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Armor',1},},
    ["15级盔甲法防紫"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Armor',1},},
    ["45级盔甲法防紫"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Armor',1},},
    ["65级盔甲法防紫"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Armor',1},},
    ["85级盔甲法防紫"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Armor',1},},
    ["105级盔甲法防紫"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Armor',1},},
    ["125级盔甲法防紫"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Armor',1},},
    ["15级盔甲法防橙"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Armor',1},},
    ["45级盔甲法防橙"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Armor',1},},
    ["65级盔甲法防橙"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Armor',1},},
    ["85级盔甲法防橙"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Armor',1},},
    ["105级盔甲法防橙"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Armor',1},},
    ["125级盔甲法防橙"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Armor',1},},
    ["15级护符物攻"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Amulet',1},},
    ["45级护符物攻"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Amulet',1},},
    ["65级护符物攻"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Amulet',1},},
    ["85级护符物攻"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Amulet',1},},
    ["105级护符物攻"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Amulet',1},},
    ["125级护符物攻"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Amulet',1},},
    ["15级护符物攻蓝"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Amulet',1},},
    ["45级护符物攻蓝"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Amulet',1},},
    ["65级护符物攻蓝"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Amulet',1},},
    ["85级护符物攻蓝"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Amulet',1},},
    ["105级护符物攻蓝"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Amulet',1},},
    ["125级护符物攻蓝"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Amulet',1},},
    ["15级护符物攻紫"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Amulet',1},},
    ["45级护符物攻紫"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Amulet',1},},
    ["65级护符物攻紫"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Amulet',1},},
    ["85级护符物攻紫"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Amulet',1},},
    ["105级护符物攻紫"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Amulet',1},},
    ["125级护符物攻紫"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Amulet',1},},
    ["15级护符物攻橙"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Amulet',1},},
    ["45级护符物攻橙"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Amulet',1},},
    ["65级护符物攻橙"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Amulet',1},},
    ["85级护符物攻橙"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Amulet',1},},
    ["105级护符物攻橙"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Amulet',1},},
    ["125级护符物攻橙"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Amulet',1},},
    ["15级护符法攻"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Amulet',1},},
    ["45级护符法攻"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Amulet',1},},
    ["65级护符法攻"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Amulet',1},},
    ["85级护符法攻"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Amulet',1},},
    ["105级护符法攻"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Amulet',1},},
    ["125级护符法攻"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Amulet',1},},
    ["15级护符法攻蓝"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Amulet',1},},
    ["45级护符法攻蓝"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Amulet',1},},
    ["65级护符法攻蓝"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Amulet',1},},
    ["85级护符法攻蓝"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Amulet',1},},
    ["105级护符法攻蓝"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Amulet',1},},
    ["125级护符法攻蓝"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Amulet',1},},
    ["15级护符法攻紫"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Amulet',1},},
    ["45级护符法攻紫"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Amulet',1},},
    ["65级护符法攻紫"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Amulet',1},},
    ["85级护符法攻紫"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Amulet',1},},
    ["105级护符法攻紫"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Amulet',1},},
    ["125级护符法攻紫"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Amulet',1},},
    ["15级护符法攻橙"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Amulet',1},},
    ["45级护符法攻橙"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Amulet',1},},
    ["65级护符法攻橙"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Amulet',1},},
    ["85级护符法攻橙"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Amulet',1},},
    ["105级护符法攻橙"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Amulet',1},},
    ["125级护符法攻橙"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Amulet',1},},
    ["0级参战宠物饰品"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Access',1},},
    ["5级参战宠物饰品"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Access',1},},
    ["15级参战宠物饰品"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Access',1},},
    ["25级参战宠物饰品"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Access',1},},
    ["35级参战宠物饰品"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Access',1},},
    ["45级参战宠物饰品"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Access',1},},
    ["55级参战宠物饰品"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Access',1},},
    ["65级参战宠物饰品"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Access',1},},
    ["75级参战宠物饰品"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Access',1},},
    ["85级参战宠物饰品"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Access',1},},
    ["95级参战宠物饰品"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Access',1},},
    ["105级参战宠物饰品"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Access',1},},
    ["115级参战宠物饰品"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Access',1},},
    ["神兽饰品"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Access',1},},
    ["仙兽饰品"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Access',1},},
    ["魔兽饰品"] = {RandAttr = {'PetEquip_Start',1,'PetEquip_Access',1},},
}

function PetEquipReBuild.LinkTbTest(EquipType, SiteType, Role, Level, Alevel)
	local key = EquipType .. "_" .. SiteType .. "_" .. Role .. "_" .. Level .. "_" .. Alevel
	local LinkTb = PetEquipReBuild.Links[key]
	if LinkTb then
		return LinkTb
	end
	key = EquipType .. "_" .. SiteType .. "_" .. Role .. "_" .. Level .. "_0"
	LinkTb = PetEquipReBuild.Links[key]
	if LinkTb then
		return LinkTb
	end
	key = EquipType .. "_" .. SiteType .. "_" .. Role .. "_0_"..Alevel
	LinkTb = PetEquipReBuild.Links[key]
	if LinkTb then
		return LinkTb
	end
	key = EquipType .. "_" .. SiteType .. "_" .. Role .. "_0_0"
	LinkTb = PetEquipReBuild.Links[key]
	if LinkTb then
		return LinkTb
	end
	key = EquipType .. "_" .. SiteType .. "_0_" .. Level .. "_" .. Alevel
	LinkTb = PetEquipReBuild.Links[key]
	if LinkTb then
		return LinkTb
	end
	key = EquipType .. "_" .. SiteType .. "_0_" .. Level .. "_0"
	LinkTb = PetEquipReBuild.Links[key]
	if LinkTb then
		return LinkTb
	end
	key = EquipType .. "_" .. SiteType .. "_0_0_" .. Alevel
	LinkTb = PetEquipReBuild.Links[key]
	if LinkTb then
		return LinkTb
	end
	key = EquipType .. "_" .. SiteType .. "_0_0_0"
	LinkTb = PetEquipReBuild.LibraryLink[key]
	if LinkTb then
		return LinkTb
	end
	key = "0_0_0_0_0"
	LinkTb = PetEquipReBuild.LibraryLink[key]
	if LinkTb then
		return LinkTb
	end
	
	return nil
end

function PetEquipReBuild.Initialization(check)
	if check ~= 0 then
		return
	end
	--print("PetEquipReBuild.Initialization")
	if not PetEquipReBuildConfig then
		require("form/PetEquipBuild_Config")
	end
	if PetEquipReBuildConfig then
		--print("PetEquipReBuildConfig")
		if not PetEquipReBuild.Links then
			PetEquipReBuild.Links = {}
		end
		
		if PetEquipReBuild.LibraryLink then
			for k,v in pairs(PetEquipReBuild.LibraryLink) do
				local key = ''..(v.EquipType or '0')..'_'..(v.SiteType or '0')..'_'..(v.Role or '0')..'_'..(v.Level or '0')..'_'..(v.Alevel or '0')
				PetEquipReBuild.Links[key] = {}
				if v.LockAttr then
					PetEquipReBuild.Links[key]['LockAttr'] = {}
					for a,b in ipairs(v.LockAttr) do
						PetEquipReBuild.Links[key]['LockAttr'][AttrConfig.GetByKeyName(b).Id] = 1
					end
					PetEquipReBuild.Links[key]['RandAttr'] = v.RandAttr
				end				
			end
		end
		--print(Lua_tools.serialize(PetEquipReBuild.Synthesis))
	end
	PetEquipReBuild.AllowList = {}
	for k,v in pairs(PetEquipReBuild.KeyNameLink) do
		local id = ItemConfig.GetByKeyName(k).Id
		if id then
			PetEquipReBuild.AllowList[id] = 1
		end
	end
end